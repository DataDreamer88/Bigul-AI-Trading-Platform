<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analysis | Bigul AI Trading</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <span class="logo-text">Bigul<span class="logo-ai">AI</span></span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="screener.html" class="nav-link">Screener</a>
                <a href="chatbot.html" class="nav-link">AI Chat</a>
                <a href="settings.html" class="nav-link">Settings</a>
            </div>
        </div>
    </nav>

    <div class="container" style="padding: 2rem 0;">
        <!-- Stock Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
                <h1 id="stockName" style="margin-bottom: 0.5rem;">Loading...</h1>
                <p style="color: var(--text-secondary); font-size: 1.1rem;">
                    <span id="stockSymbol">---</span> ‚Ä¢ <span id="stockSector">Sector</span>
                </p>
            </div>
            <div style="text-align: right;">
                <p style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin: 0;">
                    ‚Çπ<span id="stockPrice">0</span>
                </p>
                <p style="font-size: 1.5rem; margin: 0; color: var(--success);">
                    <span id="stockChange">+0.00%</span>
                </p>
            </div>
        </div>

        <!-- AI Insight -->
        <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #e6f0ff 0%, #f0f9ff 100%); border-left: 4px solid var(--primary);">
            <h3 style="color: var(--primary); margin-bottom: 0.5rem;">ü§ñ AI Analysis</h3>
            <p id="aiAnalysis">Analyzing stock fundamentals and technicals...</p>
        </div>

        <!-- Key Metrics -->
        <h2 style="margin-bottom: 1.5rem;">üìä Key Metrics</h2>
        <div class="grid grid-4" style="margin-bottom: 3rem;">
            <div class="card">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 0.5rem 0;">Market Cap</p>
                <p style="font-size: 1.5rem; font-weight: 700; margin: 0;" id="marketCap">‚Çπ0</p>
            </div>
            <div class="card">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 0.5rem 0;">PE Ratio</p>
                <p style="font-size: 1.5rem; font-weight: 700; margin: 0;" id="peRatio">0.0x</p>
            </div>
            <div class="card">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 0.5rem 0;">ROE</p>
                <p style="font-size: 1.5rem; font-weight: 700; margin: 0;" id="roe">0.0%</p>
            </div>
            <div class="card">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 0.5rem 0;">RSI</p>
                <p style="font-size: 1.5rem; font-weight: 700; margin: 0;" id="rsi">0</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-2" style="margin-bottom: 3rem;">
            <div class="card">
                <h3 style="margin-bottom: 1rem;">üìà Price Chart (5 Days)</h3>
                <div style="height: 300px;">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1rem;">üìä Technical Indicators</h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>RSI (14)</span>
                            <span id="rsiValue" style="font-weight: 700;">68</span>
                        </div>
                        <div style="height: 4px; background: var(--light); border-radius: 2px; overflow: hidden;">
                            <div id="rsiBar" style="height: 100%; background: var(--success); width: 68%;"></div>
                        </div>
                    </div>
                    <div>
                        <p style="margin: 0 0 0.5rem 0;"><strong>MACD:</strong> <span id="macdStatus" style="color: var(--success);">Positive</span></p>
                    </div>
                    <div>
                        <p style="margin: 0 0 0.5rem 0;"><strong>Pattern:</strong> <span id="pattern" style="color: var(--primary);">Golden Cross</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sentiment & News -->
        <h2 style="margin-bottom: 1.5rem;">üì∞ Latest News</h2>
        <div class="grid grid-2" style="margin-bottom: 3rem;">
            <div class="card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <span style="font-size: 2rem;">üìà</span>
                    <div>
                        <p style="margin: 0; font-weight: 700;">Strong Q3 Results</p>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Expected strong earnings</p>
                    </div>
                </div>
                <span class="badge badge-success">POSITIVE</span>
            </div>

            <div class="card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <span style="font-size: 2rem;">üí∞</span>
                    <div>
                        <p style="margin: 0; font-weight: 700;">Capex Guidance</p>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Positive guidance provided</p>
                    </div>
                </div>
                <span class="badge badge-success">POSITIVE</span>
            </div>
        </div>

        <!-- Financial Summary -->
        <h2 style="margin-bottom: 1.5rem;">üíº Financial Summary</h2>
        <div class="card" style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                        <th>Industry Avg</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>P/E Ratio</td>
                        <td id="peValue">18.5</td>
                        <td>20.0</td>
                        <td><span style="color: var(--success);">‚úì Below Average</span></td>
                    </tr>
                    <tr>
                        <td>P/B Ratio</td>
                        <td id="pbValue">2.3</td>
                        <td>2.8</td>
                        <td><span style="color: var(--success);">‚úì Below Average</span></td>
                    </tr>
                    <tr>
                        <td>ROE</td>
                        <td id="roeValue">21.2%</td>
                        <td>18.0%</td>
                        <td><span style="color: var(--success);">‚úì Above Average</span></td>
                    </tr>
                    <tr>
                        <td>Debt/Equity</td>
                        <td>0.45</td>
                        <td>0.60</td>
                        <td><span style="color: var(--success);">‚úì Healthy</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button class="btn btn-primary btn-lg" onclick="addToWatchlist(currentStock.symbol)">
                ‚≠ê Add to Watchlist
            </button>
            <button class="btn btn-secondary btn-lg" onclick="createPriceAlert()">
                üîî Create Alert
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Bigul AI Trading Suite. Deep stock analysis powered by AI.</p>
        </div>
    </footer>

    <script src="js/global.js"></script>
    <script>
        let currentStock = null;

        // Get stock symbol from URL
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const symbol = params.get('symbol') || 'RELIANCE';
            loadStockData(symbol);
        });

        function loadStockData(symbol) {
            if (!appState.stocksData.length) {
                setTimeout(() => loadStockData(symbol), 500);
                return;
            }

            currentStock = appState.stocksData.find(s => s.symbol === symbol);
            if (!currentStock) {
                currentStock = appState.stocksData[0];
            }

            // Update header
            document.getElementById('stockName').textContent = currentStock.name;
            document.getElementById('stockSymbol').textContent = currentStock.symbol;
            document.getElementById('stockSector').textContent = currentStock.sector;
            document.getElementById('stockPrice').textContent = currentStock.price.toLocaleString();
            document.getElementById('stockChange').textContent = 
                (currentStock.change > 0 ? '+' : '') + currentStock.change.toFixed(2) + '%';
            document.getElementById('stockChange').style.color = 
                currentStock.change > 0 ? 'var(--success)' : 'var(--danger)';

            // Update metrics
            document.getElementById('marketCap').textContent = (currentStock.marketCap / 100000).toFixed(1) + 'L Cr';
            document.getElementById('peRatio').textContent = currentStock.pe.toFixed(1) + 'x';
            document.getElementById('roe').textContent = currentStock.roe.toFixed(1) + '%';
            document.getElementById('rsi').textContent = currentStock.rsi;

            // AI Analysis
            const sentiment = currentStock.sentiment || 'neutral';
            const pattern = currentStock.pattern || 'Consolidation';
            document.getElementById('aiAnalysis').textContent = 
                `${sentiment.toUpperCase()} signal detected. Pattern: ${pattern}. ` +
                `RSI at ${currentStock.rsi} suggests ${currentStock.rsi > 70 ? 'overbought' : currentStock.rsi < 30 ? 'oversold' : 'neutral'} conditions.`;

            // Charts
            createChart('priceChart', 'line',
                ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                [{
                    label: currentStock.symbol,
                    data: currentStock.history || [currentStock.price - 100, currentStock.price - 70, currentStock.price - 40, currentStock.price - 20, currentStock.price],
                    borderColor: 'var(--primary)',
                    backgroundColor: 'rgba(0, 102, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            );

            document.title = `${symbol} Analysis | Bigul AI Trading`;
        }

        function createPriceAlert() {
            const targetPrice = prompt(`Set price alert for ${currentStock.symbol}\nCurrent: ‚Çπ${currentStock.price}`, currentStock.price * 1.05);
            if (targetPrice) {
                addAlert(currentStock.symbol, 'price', parseFloat(targetPrice));
            }
        }
    </script>
</body>
</html>